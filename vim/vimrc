" General app prefs
" ---------------------------------------------------------------------------

set nocompatible                  " Must come first because it changes other options.
syntax enable                     " Turn on syntax highlighting.
filetype plugin indent on         " Turn on file type detection.
set encoding=utf-8                " Set default encoding
set ttyfast                       " Tell vim you're using a fast terminal.
set title                         " Set the terminal's title
set visualbell                    " Make the alerts visual instead of audio
set hidden                        " Hide buffers instead of close them (when opening a new buffer)
set wildmenu                      " Enhanced command line completion.
set wildmode=list:longest         " Complete files like a shell.
set ignorecase                    " Case-insensitive searching.
set smartcase                     " But case-sensitive if expression contains a capital letter.
set incsearch                     " Highlight matches as you type.
set hlsearch                      " Highlight matches.
set showmatch                     " Show matching brackets, etc.
set gdefault                      " Sets searches to be global (line) by default
set autoread                      " Tells vim to auto-read changes to the file from the disk.
set ttimeoutlen=50                " no delay leaving insert mode
set clipboard=unnamed             " set vim to share the system clipboard

" Treat buffers from stdin (e.g.: echo foo | vim -) as scratch buffers.
au StdinReadPost * :set buftype=nofile



" Vundle Stuff
" ---------------------------------------------------------------------------

filetype off                  " required!
set rtp+=~/.vim/bundle/vundle/
call vundle#rc()
" let Vundle manage Vundle
" required!
Bundle 'gmarik/vundle'

" Vundles...
Bundle 'jlanzarotta/bufexplorer'
Bundle "sjl/gundo.vim"
Bundle 'tpope/vim-surround'
Bundle 'scrooloose/nerdtree'
Bundle 'airblade/vim-gitgutter'
Bundle 'plasticboy/vim-markdown'
Bundle 'chriskempson/base16-vim'
Bundle 'junegunn/goyo.vim'
Bundle 'vim-scripts/fountain.vim'
Bundle 'bling/vim-airline'
Bundle 'sjl/vitality.vim'

filetype plugin indent on     " required!
"
" Brief help
" :BundleList          - list configured bundles
" :BundleInstall(!)    - install (update) bundles
" :BundleSearch(!) foo - search (or refresh cache first) for foo
" :BundleClean(!)      - confirm (or auto-approve) removal of unused bundles
"
" see :h vundle for more details or wiki for FAQ
" NOTE: comments after Bundle commands are not allowed.



" Editing Prefs
" ---------------------------------------------------------------------------
set autoindent                    " Turn on auto-indenting
set expandtab                     " Use spaces instead of tabs
set tabstop=4                     " width of tab character
set softtabstop=4                 " number of characters to delete
set shiftwidth=4                  " indentation settings
set backspace=indent,eol,start    " Intuitive backspacing.
set nojoinspaces                  " Single space between sentences when joining

" Turn on spell-checking
setlocal spell spelllang=en_us

" don't highlight capitalization errors
hi spellcap cterm=none

" Custom spell file
set spellfile=~/.vim/custom-dictionary.utf-8.add

" Toggle spell-checking
nnoremap <leader>s :set spell!<cr>

" Paste mode
set pastetoggle=<F2>

" sudo save
cmap w!! w !sudo tee % >/dev/null

" disable vim-markdown default folding
let g:vim_markdown_initial_foldlevel=1

" tell airline to use a patched powerline font
let g:airline_powerline_fonts=1



" Display Stuff
" ---------------------------------------------------------------------------

set scrolloff=3                    " Show 3 lines of context around the cursor at all times.
set cursorline                     " Highlight the line the cursor is on

" Only show cursorline in the current window and in normal mode
au WinLeave,InsertEnter * set nocul
au WinEnter,InsertLeave * set cul

" WORD-WRAPPING
set formatoptions=tcrqn            " A few misc options for formatting text,
set formatprg=par\ -w72rq          " external formatter options
set wrap                           " Turn on wrapping
set linebreak                      " Wrap only at word-breaks

" SHOW 'NONAME' BUFFERS IN BUFEXPLORER
let g:bufExplorerShowNoName=1

" Use the same symbols as TextMate for tabstops and EOLs
set listchars=tab:▸\ ,eol:¬



" COLORS
" ---------------------------------------------------------------------------

" THE STATUS BAR
set laststatus=2      "Always show status bar
set cmdheight=1       "Height of command typing area
set showcmd           "Shows your typing in Normal Mode

" COLOR SCHEME
colorscheme base16-ocean
set background=dark

nnoremap <leader>dark :set background=dark<cr>
nnoremap <leader>light :set background=light<cr>


" Shortcuts
" ---------------------------------------------------------------------------

" Saving...
" map <D-s> <esc>:w<cr>

" DISABLE THE ARROW KEYS - OH GOD...
nnoremap <up> <nop>
nnoremap <down> <nop>
nnoremap <left> <nop>
nnoremap <right> <nop>
inoremap <up> <nop>
inoremap <down> <nop>
inoremap <left> <nop>
inoremap <right> <nop>
nnoremap j gj
nnoremap k gk

" Make moving around splits easier
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" Clear search highlighting
nnoremap <leader><space> :noh<cr>

" Quick-reload of this file
nnoremap <leader>rc :source ~/.vimrc<cr>

" Open NERDTree
nnoremap <leader>nt :NERDTreeToggle<cr>

" Gundo
nnoremap <F5> :GundoToggle<CR>

" Disable ZZ - dangerous shortcut
nnoremap ZZ echo "Your Caps-lock is on."

" When moving to the end of the document also move to the end of the line
nnoremap G G$

" toggle numbers
:nnoremap <leader>num :set invnumber<cr>


" Moving lines up and down
"nnoremap <c-j> :m+<cr>
"nnoremap <c-k> :m-2<cr>

" Remap K to split the line at the point
nnoremap K i<cr><esc><bs>
inoremap <c-k> <cr><c-o><bs>

" Some things to make editing in Insert Mode a little easier

" faster spelling correction
" Mark current position, jump to last misspelled word, offer corrections
inoremap <c-z> <esc>mxa<c-x>s
" leave insert mode, jump to x mark, re-enter insert mode
"inoremap <c-l> <esc>`xa

" Goyo
nnoremap <leader>g :Goyo<cr>

" wrap
nnoremap <leader>w :set wrap!<cr>

" maintain selection on indentations
vnoremap > >gv
vnoremap < <gv


" Snippets
" ---------------------------------------------------------------------------

" date
:iab <expr> dd strftime("[%Y-%m-%dT%H:%M:%S%z]")



" Misc Functions
" ---------------------------------------------------------------------------
function! <SID>StripTrailingWhitespaces()
    " Preparation: save last search, and cursor position.
    let _s=@/
    let l = line(".")
    let c = col(".")
    " Do the business:
    %s/\s\+$//e
    " Clean up: restore previous search history, and cursor position
    let @/=_s
    call cursor(l, c)
endfunction

nnoremap <silent> <leader>dtrail :call <SID>StripTrailingWhitespaces()<CR>


" Markdown customizations
" ---------------------------------------------------------------------------

nnoremap <leader>mdown :set filetype=mkd<cr>


" rst customizations
" ---------------------------------------------------------------------------

nnoremap <leader>rst :set filetype=rst<cr>

augroup filetypedetect_rst
    au!
    " Headings
    au FileType rst nnoremap <leader>h1 ^yypv$r=o<cr><esc>
    au FileType rst inoremap <leader>h1 <esc>^yypv$r=o<cr>

    au FileType rst nnoremap <leader>h2 ^yypv$r-o<cr><esc>
    au FileType rst inoremap <leader>h2 <esc>^yypv$r-o<cr><esc>

    au FileType rst nnoremap <leader>h3 ^yypv$r+o<cr><esc>
    au FileType rst inoremap <leader>h3 <esc>^yypv$r+o<cr><esc>

    "Create note
    au FileType rst iabbrev nnn .. note::
augroup END
