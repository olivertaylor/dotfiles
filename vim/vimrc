" Plugins
" ------------------------------------------------------------------------

call plug#begin('~/.vim/plugged')

Plug 'Shougo/unite.vim'
Plug 'tpope/vim-surround'
Plug 'airblade/vim-gitgutter'
Plug 'mbbill/undotree'
Plug 'junegunn/goyo.vim'
Plug 'plasticboy/vim-markdown'
Plug 'gerw/vim-HiLinkTrace'
Plug 'Shougo/unite-outline'
Plug 'christoomey/vim-tmux-navigator'

call plug#end()

" General Preferences
" ------------------------------------------------------------------------

set encoding=utf-8                " Set default encoding
set modelines=0                   " disable modelines
set dir=~/.swp-dir,.              " Centralize swp files
set undodir=~/code/vimundo        " Centralize undo files
set undofile                      " Keep permanent history of undos
syntax enable                     " Turn on syntax highlighting
set hidden                        " Hide buffers instead of closing them
set visualbell                    " Make alerts not audio
set wildmenu                      " Enhanced command line completion
set wildmode=list:longest         " Complete files like a shell.
set ignorecase                    " Case-insensitive searching...
set smartcase                     " ...unless there's a cap letter
set incsearch                     " Highlight matches as you type
set hlsearch                      " Highlight search matches
set clipboard=unnamed             " set vim to share the system clipboard
set wrap                          " Turn on wrapping
set linebreak                     " Wrap only at word-breaks
set breakindent                   " Wrap lines to indent
set autoindent                    " Turn on auto-indenting
set copyindent                    " copy previous indentation on paste
set expandtab                     " Use spaces instead of tabs
set tabstop=4                     " width of tab character
set softtabstop=4                 " number of characters to delete
set shiftwidth=4                  " indentation settings
set backspace=indent,eol,start    " Intuitive backspacing.
set nojoinspaces                  " Join with single space
set spell spelllang=en_us         " Turn on spell-checking
set formatoptions=tcrqn1j         " (see docs)
set formatprg=par\ -w78rq         " external formatter options
set laststatus=2                  " Always show status bar
set showcmd                       " Show commands as you type
set scrolloff=2                   " Show N lines around cursor
"set cursorline                    " highlight cursor line
"set number                        " Show line-numbers
set display+=lastline             " Don't truncate the last line
" Open new split panes to right and bottom, which feels more natural
set splitbelow
set splitright
set sessionoptions=buffers,curdir,folds,help,tabpages,tabpages
set spellfile=~/.vim/custom-dictionary.utf-8.add

" Treat buffers from stdin (e.g.: echo foo | vim -) as scratch buffers.
au StdinReadPost * :set buftype=nofile

" Use the same symbols as TextMate for tabstops and EOLs
set listchars=tab:▸\ ,eol:¬,trail:+,extends:>,precedes:<,nbsp:⌙

" Statusline
set statusline=%f         "path to file in buffer
set statusline+=%m        "modified/modifiable flag
set statusline+=\ %y      "filetype
set statusline+=%=        "left/right alignment separator
set statusline+=%{strlen(&fenc)?&fenc:'none'}[%{&ff}]   "file encoding
set statusline+=\ \ %P      "percentage through file
set statusline+=\ %l,%c   "line,column

" COLOR SCHEME
colorscheme oliver-ocean.dark
set background=dark


" ------------------------------------------------------------------------

" Make mode-switching easy, use <c-v>` to insert literal backtick
nnoremap ` <esc>
inoremap ` <esc>
vnoremap ` <esc>

" DISABLE THE ARROW KEYS - OH GOD...
nnoremap <up> <nop>
nnoremap <down> <nop>
nnoremap <left> <nop>
nnoremap <right> <nop>
inoremap <up> <nop>
inoremap <down> <nop>
inoremap <left> <nop>
inoremap <right> <nop>

" Make command-mode easier to enter
nnoremap ; :
vnoremap ; :
nnoremap , ;
vnoremap , ;

" Make j and k behave as expected
nnoremap j gj
nnoremap k gk
vnoremap j gj
vnoremap k gk

" Make moving around splits easier
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" make regexp search not suck by default
nnoremap / /\v
vnoremap / /\v

" maintain selection on indentations
vnoremap > >gv
vnoremap < <gv

" Easier buffer navigation
nnoremap gb :bn<cr>
nnoremap gB :bp<cr>

" creates an alias (%%) to represent the directory of the current file
cnoremap %% <C-R>=fnameescape(expand('%:h')).'/'<cr>

" CTRL-U in insert mode deletes a lot.  Use CTRL-G u to first break undo,
" so that you can undo CTRL-U after inserting a line break.
inoremap <C-U> <C-G>u<C-U>

" Remap K to split the line at the point
nnoremap K i<cr><esc>`.
inoremap <c-k> <cr><c-o><bs>

" Move lines
vnoremap J :m '>+1<cr>gv
vnoremap K :m '<-2<cr>gv

" Quickly select text you just pasted:
noremap gV `[v`]

" allow saving a sudo file if forgot to open as sudo
cmap w!! w !sudo tee % >/dev/null

" protect against accidental save + close
nnoremap ZZ :echoe "Your Caps-lock is on."<cr>

" Paste mode
set pastetoggle=<F2>

nmap [h <Plug>GitGutterPrevHunk
nmap ]h <Plug>GitGutterNextHunk

" Never use a binding when a command will do
" commands are easier to remember and autocomplete
" also, it's just vim-style
command BGd set background=dark | colorscheme oliver-ocean.dark
command BGl set background=light | colorscheme oliver.light
command Cdf :cd %:h<cr>
command Cl :set cursorline!
command Dtrail :%s/\s\+$//<cr>:let @/=''<CR>
command Fmkd :set filetype=mkd
command Frst :set filetype=rst
command H1 :normal VUyypVr=
command H2 :normal yypVr-
command NN :set invnumber
command Nr :set relativenumber!
command SS :set spell!
command Src :source $MYVIMRC
command Evrc :e ~/code/dotfiles/vim/vimrc
command WW :set wrap!

au BufRead,BufNewFile *.fountain	 set filetype=fountain

" Make sure Vim returns to the same line when you reopen a file.
augroup line_return
    au!
    au BufReadPost *
        \ if line("'\"") > 0 && line("'\"") <= line("$") |
        \     execute 'normal! g`"zvzz' |
        \ endif
augroup END

" Don't write undofiles for secret stuff
au BufWritePre /Volumes/secret_files/* setlocal noundofile

" Unite
" ------------------------------------------------------------------------

" Start by setting some defaults
call unite#filters#matcher_default#use(['matcher_fuzzy'])
call unite#filters#sorter_default#use(['sorter_selecta'])

" for file_rec use a custom sorter
"call unite#custom#source('file_rec', 'sorters', 'sorter_selecta')

" shortcuts for calling Unite
nnoremap <leader>b :Unite -no-split buffer<cr>
nnoremap <leader>f :Unite -no-split file file/new directory/new<cr>
nnoremap <leader>us :Unite -no-split -start-insert source<cr>
nnoremap <leader>ul :Unite -no-split -start-insert line<cr>
nnoremap <leader>uo :Unite -no-split -start-insert outline<cr>

" Custom mappings for the unite buffer
autocmd FileType unite call s:unite_settings()
function! s:unite_settings()
  " Enable navigation with control-n and control-p in insert mode
  imap <buffer> <C-n>   <Plug>(unite_select_next_line)
  imap <buffer> <C-p>   <Plug>(unite_select_previous_line)
endfunction

" Snippets
" ------------------------------------------------------------------------

" Timestamp in brackets like this: [2014-06-08T10:41:44-0700]
iab <expr> dd strftime("[%Y-%m-%dT%H:%M:%S%z]")

" TODO:
" Move lines up/down
" new line, increment number
" <clippings>
"   date (various formats)
"   lorem
"   point-of-view
"   work-in-progress
